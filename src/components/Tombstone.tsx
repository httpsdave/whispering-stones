import React, { useState } from 'react';
import type { TombstoneStyle } from '@/types';

interface TombstoneProps {
  style: TombstoneStyle;
  name: string;
  birthDate?: string | null;
  deathDate?: string | null;
  epitaph: string;
  onClick?: () => void;
  className?: string;
}

// Color palette for pixel art
const COLORS: Record<string, string> = {
  _: 'transparent',
  // Stone colors - light to dark
  '0': '#9ca3af', // lightest stone (highlight)
  '1': '#6b7280', // light stone
  '2': '#4b5563', // medium stone
  '3': '#374151', // dark stone
  '4': '#1f2937', // darkest stone (shadow)
  '5': '#111827', // near black
  // Moss colors
  'm': '#4a5d4a', // moss dark
  'M': '#5c7a5c', // moss light
  // Base/ground
  'b': '#1f2937', // base dark
  'B': '#374151', // base light
};

// 24x24 pixel art designs for each tombstone style
const TOMBSTONE_DESIGNS: Record<number, string[][]> = {
  // Style 1: Classic rounded tombstone
  1: [
    ['_','_','_','_','_','_','_','_','0','0','0','0','0','0','0','0','_','_','_','_','_','_','_','_'],
    ['_','_','_','_','_','_','0','0','1','1','1','1','1','1','1','1','0','0','_','_','_','_','_','_'],
    ['_','_','_','_','_','0','1','1','1','1','1','1','1','1','1','1','1','1','0','_','_','_','_','_'],
    ['_','_','_','_','0','1','1','1','1','2','2','2','2','2','2','1','1','1','1','0','_','_','_','_'],
    ['_','_','_','0','1','1','1','2','2','2','2','2','2','2','2','2','2','1','1','1','0','_','_','_'],
    ['_','_','0','1','1','1','2','2','2','2','2','2','2','2','2','2','2','2','1','1','1','0','_','_'],
    ['_','_','0','1','1','2','2','2','2','2','2','2','2','2','2','2','2','2','2','1','1','0','_','_'],
    ['_','_','0','1','1','2','2','2','2','2','2','2','2','2','2','2','2','2','2','1','1','0','_','_'],
    ['_','_','0','1','1','2','2','2','2','2','2','2','2','2','2','2','2','2','2','1','1','0','_','_'],
    ['_','_','0','1','1','2','2','2','2','2','2','2','2','2','2','2','2','2','2','1','1','0','_','_'],
    ['_','_','0','1','1','2','2','2','2','2','2','2','2','2','2','2','2','2','2','1','1','0','_','_'],
    ['_','_','0','1','1','2','2','2','2','2','2','2','2','2','2','2','2','2','2','1','1','0','_','_'],
    ['_','_','0','1','1','2','2','2','2','2','2','2','2','2','2','2','2','2','2','1','1','0','_','_'],
    ['_','_','0','1','1','2','2','2','2','2','2','2','2','2','2','2','2','2','2','1','1','0','_','_'],
    ['_','_','0','1','1','2','2','2','2','2','2','2','2','2','2','2','2','2','2','3','3','0','_','_'],
    ['_','_','0','1','1','2','2','2','2','2','2','2','2','2','2','2','2','2','3','3','3','0','_','_'],
    ['_','_','0','1','1','2','2','2','2','2','2','2','2','2','2','2','2','3','3','3','3','0','_','_'],
    ['_','_','0','1','1','2','2','2','2','2','2','2','2','2','2','2','3','3','3','3','3','0','_','_'],
    ['_','_','0','3','3','3','3','3','3','3','3','3','3','3','3','3','3','3','3','3','3','0','_','_'],
    ['_','0','4','4','4','4','4','4','4','4','4','4','4','4','4','4','4','4','4','4','4','4','0','_'],
    ['_','0','B','B','B','B','B','B','B','B','B','B','B','B','B','B','B','B','B','B','B','B','0','_'],
    ['0','4','b','b','b','b','b','b','b','b','b','b','b','b','b','b','b','b','b','b','b','b','4','0'],
    ['0','4','b','b','b','b','b','b','b','b','b','b','b','b','b','b','b','b','b','b','b','b','4','0'],
    ['5','5','5','5','5','5','5','5','5','5','5','5','5','5','5','5','5','5','5','5','5','5','5','5'],
  ],
  // Style 2: Simple cross
  2: [
    ['_','_','_','_','_','_','_','_','_','_','0','0','0','0','_','_','_','_','_','_','_','_','_','_'],
    ['_','_','_','_','_','_','_','_','_','0','1','1','1','1','0','_','_','_','_','_','_','_','_','_'],
    ['_','_','_','_','_','_','_','_','_','0','1','2','2','1','0','_','_','_','_','_','_','_','_','_'],
    ['_','_','_','_','_','_','_','_','_','0','1','2','2','3','0','_','_','_','_','_','_','_','_','_'],
    ['_','_','_','_','_','_','_','_','_','0','1','2','2','3','0','_','_','_','_','_','_','_','_','_'],
    ['_','_','_','0','0','0','0','0','0','0','1','2','2','3','0','0','0','0','0','0','0','_','_','_'],
    ['_','_','0','1','1','1','1','1','1','1','1','2','2','2','1','1','1','1','1','1','1','0','_','_'],
    ['_','_','0','1','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','3','0','_','_'],
    ['_','_','0','1','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','3','0','_','_'],
    ['_','_','0','3','3','3','3','3','3','3','3','2','2','3','3','3','3','3','3','3','3','0','_','_'],
    ['_','_','_','0','0','0','0','0','0','0','1','2','2','3','0','0','0','0','0','0','0','_','_','_'],
    ['_','_','_','_','_','_','_','_','_','0','1','2','2','3','0','_','_','_','_','_','_','_','_','_'],
    ['_','_','_','_','_','_','_','_','_','0','1','2','2','3','0','_','_','_','_','_','_','_','_','_'],
    ['_','_','_','_','_','_','_','_','_','0','1','2','2','3','0','_','_','_','_','_','_','_','_','_'],
    ['_','_','_','_','_','_','_','_','_','0','1','2','2','3','0','_','_','_','_','_','_','_','_','_'],
    ['_','_','_','_','_','_','_','_','_','0','1','2','2','3','0','_','_','_','_','_','_','_','_','_'],
    ['_','_','_','_','_','_','_','_','_','0','1','2','2','3','0','_','_','_','_','_','_','_','_','_'],
    ['_','_','_','_','_','_','_','_','_','0','1','2','3','3','0','_','_','_','_','_','_','_','_','_'],
    ['_','_','_','_','_','_','_','_','_','0','3','3','3','3','0','_','_','_','_','_','_','_','_','_'],
    ['_','_','_','_','_','_','0','0','0','4','4','4','4','4','4','0','0','0','_','_','_','_','_','_'],
    ['_','_','_','_','_','0','B','B','B','B','B','B','B','B','B','B','B','B','0','_','_','_','_','_'],
    ['_','_','_','_','0','4','b','b','b','b','b','b','b','b','b','b','b','b','4','0','_','_','_','_'],
    ['_','_','_','_','0','4','b','b','b','b','b','b','b','b','b','b','b','b','4','0','_','_','_','_'],
    ['_','_','_','_','5','5','5','5','5','5','5','5','5','5','5','5','5','5','5','5','_','_','_','_'],
  ],
  // Style 3: Gothic arch with RIP
  3: [
    ['_','_','_','_','_','_','_','_','_','_','0','0','0','0','_','_','_','_','_','_','_','_','_','_'],
    ['_','_','_','_','_','_','_','_','0','0','1','1','1','1','0','0','_','_','_','_','_','_','_','_'],
    ['_','_','_','_','_','_','_','0','1','1','1','1','1','1','1','1','0','_','_','_','_','_','_','_'],
    ['_','_','_','_','_','_','0','1','1','1','2','2','2','2','1','1','1','0','_','_','_','_','_','_'],
    ['_','_','_','_','_','0','1','1','1','2','2','2','2','2','2','1','1','1','0','_','_','_','_','_'],
    ['_','_','_','_','0','1','1','1','2','2','2','2','2','2','2','2','1','1','1','0','_','_','_','_'],
    ['_','_','_','0','1','1','1','2','2','2','2','2','2','2','2','2','2','1','1','1','0','_','_','_'],
    ['_','_','0','1','1','1','2','2','2','2','2','2','2','2','2','2','2','2','1','1','1','0','_','_'],
    ['_','_','0','1','1','2','2','2','2','2','2','2','2','2','2','2','2','2','2','1','1','0','_','_'],
    ['_','_','0','1','1','2','2','2','2','2','2','2','2','2','2','2','2','2','2','1','1','0','_','_'],
    ['_','_','0','1','1','2','2','2','2','2','2','2','2','2','2','2','2','2','2','1','1','0','_','_'],
    ['_','_','0','1','1','2','2','2','2','2','2','2','2','2','2','2','2','2','2','1','1','0','_','_'],
    ['_','_','0','1','1','2','2','2','2','2','2','2','2','2','2','2','2','2','2','1','1','0','_','_'],
    ['_','_','0','1','1','2','2','2','2','2','2','2','2','2','2','2','2','2','2','1','1','0','_','_'],
    ['_','_','0','1','1','2','2','2','2','2','2','2','2','2','2','2','2','2','2','3','3','0','_','_'],
    ['_','_','0','1','1','2','2','2','2','2','2','2','2','2','2','2','2','2','3','3','3','0','_','_'],
    ['_','_','0','1','1','2','2','2','2','2','2','2','2','2','2','2','2','3','3','3','3','0','_','_'],
    ['_','_','0','1','1','2','2','2','2','2','2','2','2','2','2','2','3','3','3','3','3','0','_','_'],
    ['_','_','0','3','3','3','3','3','3','3','3','3','3','3','3','3','3','3','3','3','3','0','_','_'],
    ['_','0','4','4','4','4','4','4','4','4','4','4','4','4','4','4','4','4','4','4','4','4','0','_'],
    ['_','0','B','B','B','B','B','B','B','B','B','B','B','B','B','B','B','B','B','B','B','B','0','_'],
    ['0','4','b','b','b','b','b','b','b','b','b','b','b','b','b','b','b','b','b','b','b','b','4','0'],
    ['0','4','b','b','b','b','b','b','b','b','b','b','b','b','b','b','b','b','b','b','b','b','4','0'],
    ['5','5','5','5','5','5','5','5','5','5','5','5','5','5','5','5','5','5','5','5','5','5','5','5'],
  ],
  // Style 4: Ornate monument with obelisk top
  4: [
    ['_','_','_','_','_','_','_','_','_','_','_','0','0','_','_','_','_','_','_','_','_','_','_','_'],
    ['_','_','_','_','_','_','_','_','_','_','0','1','1','0','_','_','_','_','_','_','_','_','_','_'],
    ['_','_','_','_','_','_','_','_','_','0','1','1','2','1','0','_','_','_','_','_','_','_','_','_'],
    ['_','_','_','_','_','_','_','_','0','1','1','2','2','2','1','0','_','_','_','_','_','_','_','_'],
    ['_','_','_','_','_','_','_','0','1','1','2','2','2','2','2','1','0','_','_','_','_','_','_','_'],
    ['_','_','_','_','_','_','0','1','1','2','2','2','2','2','2','2','1','0','_','_','_','_','_','_'],
    ['_','_','_','_','_','0','4','4','4','4','4','4','4','4','4','4','4','4','0','_','_','_','_','_'],
    ['_','_','_','_','0','1','1','1','1','1','1','1','1','1','1','1','1','1','1','0','_','_','_','_'],
    ['_','_','_','_','0','1','1','2','2','2','2','2','2','2','2','2','2','1','1','0','_','_','_','_'],
    ['_','_','_','_','0','1','1','2','2','2','2','2','2','2','2','2','2','1','1','0','_','_','_','_'],
    ['_','_','_','_','0','1','1','2','2','2','2','2','2','2','2','2','2','1','1','0','_','_','_','_'],
    ['_','_','_','_','0','1','1','2','2','2','2','2','2','2','2','2','2','3','3','0','_','_','_','_'],
    ['_','_','_','_','0','1','1','2','2','2','2','2','2','2','2','2','3','3','3','0','_','_','_','_'],
    ['_','_','_','_','0','1','1','2','2','2','2','2','2','2','2','3','3','3','3','0','_','_','_','_'],
    ['_','_','_','_','0','3','3','3','3','3','3','3','3','3','3','3','3','3','3','0','_','_','_','_'],
    ['_','_','_','0','4','4','4','4','4','4','4','4','4','4','4','4','4','4','4','4','0','_','_','_'],
    ['_','_','0','1','1','1','1','1','1','1','1','1','1','1','1','1','1','1','1','1','1','0','_','_'],
    ['_','_','0','1','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','3','3','0','_','_'],
    ['_','_','0','3','3','3','3','3','3','3','3','3','3','3','3','3','3','3','3','3','3','0','_','_'],
    ['_','0','4','4','4','4','4','4','4','4','4','4','4','4','4','4','4','4','4','4','4','4','0','_'],
    ['_','0','B','B','B','B','B','B','B','B','B','B','B','B','B','B','B','B','B','B','B','B','0','_'],
    ['0','4','b','b','b','b','b','b','b','b','b','b','b','b','b','b','b','b','b','b','b','b','4','0'],
    ['0','4','b','b','b','b','b','b','b','b','b','b','b','b','b','b','b','b','b','b','b','b','4','0'],
    ['5','5','5','5','5','5','5','5','5','5','5','5','5','5','5','5','5','5','5','5','5','5','5','5'],
  ],
  // Style 5: Sharp pointed gothic
  5: [
    ['_','_','_','_','_','_','_','_','_','_','_','0','0','_','_','_','_','_','_','_','_','_','_','_'],
    ['_','_','_','_','_','_','_','_','_','_','0','1','1','0','_','_','_','_','_','_','_','_','_','_'],
    ['_','_','_','_','_','_','_','_','_','0','1','1','1','1','0','_','_','_','_','_','_','_','_','_'],
    ['_','_','_','_','_','_','_','_','0','1','1','1','1','1','1','0','_','_','_','_','_','_','_','_'],
    ['_','_','_','_','_','_','_','0','1','1','1','2','2','1','1','1','0','_','_','_','_','_','_','_'],
    ['_','_','_','_','_','_','0','1','1','1','2','2','2','2','1','1','1','0','_','_','_','_','_','_'],
    ['_','_','_','_','_','0','1','1','1','2','2','2','2','2','2','1','1','1','0','_','_','_','_','_'],
    ['_','_','_','_','0','1','1','1','2','2','2','2','2','2','2','2','1','1','1','0','_','_','_','_'],
    ['_','_','_','0','1','1','1','2','2','2','2','2','2','2','2','2','2','1','1','1','0','_','_','_'],
    ['_','_','0','1','1','1','2','2','2','2','2','2','2','2','2','2','2','2','1','1','1','0','_','_'],
    ['_','_','0','1','1','2','2','2','2','2','2','2','2','2','2','2','2','2','2','1','1','0','_','_'],
    ['_','_','0','1','1','2','2','2','2','2','2','2','2','2','2','2','2','2','2','1','1','0','_','_'],
    ['_','_','0','1','1','2','2','2','2','2','2','2','2','2','2','2','2','2','2','1','1','0','_','_'],
    ['_','_','0','1','1','2','2','2','2','2','2','2','2','2','2','2','2','2','2','1','1','0','_','_'],
    ['_','_','0','1','1','2','2','2','2','2','2','2','2','2','2','2','2','2','2','3','3','0','_','_'],
    ['_','_','0','1','1','2','2','2','2','2','2','2','2','2','2','2','2','2','3','3','3','0','_','_'],
    ['_','_','0','1','1','2','2','2','2','2','2','2','2','2','2','2','2','3','3','3','3','0','_','_'],
    ['_','_','0','1','1','2','2','2','2','2','2','2','2','2','2','2','3','3','3','3','3','0','_','_'],
    ['_','_','0','3','3','3','3','3','3','3','3','3','3','3','3','3','3','3','3','3','3','0','_','_'],
    ['_','0','4','4','4','4','4','4','4','4','4','4','4','4','4','4','4','4','4','4','4','4','0','_'],
    ['_','0','B','B','B','B','B','B','B','B','B','B','B','B','B','B','B','B','B','B','B','B','0','_'],
    ['0','4','b','b','b','b','b','b','b','b','b','b','b','b','b','b','b','b','b','b','b','b','4','0'],
    ['0','4','b','b','b','b','b','b','b','b','b','b','b','b','b','b','b','b','b','b','b','b','4','0'],
    ['5','5','5','5','5','5','5','5','5','5','5','5','5','5','5','5','5','5','5','5','5','5','5','5'],
  ],
  // Style 6: Simple rectangle (clean, sharp edges)
  6: [
    ['_','_','_','_','_','_','_','_','_','_','_','_','_','_','_','_','_','_','_','_','_','_','_','_'],
    ['_','_','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','_','_'],
    ['_','_','0','1','1','1','1','1','1','1','1','1','1','1','1','1','1','1','1','1','1','0','_','_'],
    ['_','_','0','1','1','1','1','1','1','1','1','1','1','1','1','1','1','1','1','1','1','0','_','_'],
    ['_','_','0','1','1','2','2','2','2','2','2','2','2','2','2','2','2','2','2','1','1','0','_','_'],
    ['_','_','0','1','1','2','2','2','2','2','2','2','2','2','2','2','2','2','2','1','1','0','_','_'],
    ['_','_','0','1','1','2','2','2','2','2','2','2','2','2','2','2','2','2','2','1','1','0','_','_'],
    ['_','_','0','1','1','2','2','2','2','2','2','2','2','2','2','2','2','2','2','1','1','0','_','_'],
    ['_','_','0','1','1','2','2','2','2','2','2','2','2','2','2','2','2','2','2','1','1','0','_','_'],
    ['_','_','0','1','1','2','2','2','2','2','2','2','2','2','2','2','2','2','2','1','1','0','_','_'],
    ['_','_','0','1','1','2','2','2','2','2','2','2','2','2','2','2','2','2','2','1','1','0','_','_'],
    ['_','_','0','1','1','2','2','2','2','2','2','2','2','2','2','2','2','2','2','1','1','0','_','_'],
    ['_','_','0','1','1','2','2','2','2','2','2','2','2','2','2','2','2','2','2','1','1','0','_','_'],
    ['_','_','0','1','1','2','2','2','2','2','2','2','2','2','2','2','2','2','2','1','1','0','_','_'],
    ['_','_','0','1','1','2','2','2','2','2','2','2','2','2','2','2','2','2','2','3','3','0','_','_'],
    ['_','_','0','1','1','2','2','2','2','2','2','2','2','2','2','2','2','2','3','3','3','0','_','_'],
    ['_','_','0','1','1','2','2','2','2','2','2','2','2','2','2','2','2','3','3','3','3','0','_','_'],
    ['_','_','0','1','1','2','2','2','2','2','2','2','2','2','2','2','3','3','3','3','3','0','_','_'],
    ['_','_','0','3','3','3','3','3','3','3','3','3','3','3','3','3','3','3','3','3','3','0','_','_'],
    ['_','0','4','4','4','4','4','4','4','4','4','4','4','4','4','4','4','4','4','4','4','4','0','_'],
    ['_','0','B','B','B','B','B','B','B','B','B','B','B','B','B','B','B','B','B','B','B','B','0','_'],
    ['0','4','b','b','b','b','b','b','b','b','b','b','b','b','b','b','b','b','b','b','b','b','4','0'],
    ['0','4','b','b','b','b','b','b','b','b','b','b','b','b','b','b','b','b','b','b','b','b','4','0'],
    ['5','5','5','5','5','5','5','5','5','5','5','5','5','5','5','5','5','5','5','5','5','5','5','5'],
  ],
  // Style 7: Weathered/mossy rounded stone
  7: [
    ['_','_','_','_','_','_','_','_','0','0','M','m','0','0','_','_','_','_','_','_','_','_','_','_'],
    ['_','_','_','_','_','_','0','0','1','M','m','M','m','1','0','0','_','_','_','_','_','_','_','_'],
    ['_','_','_','_','_','0','1','1','M','m','1','1','m','M','1','1','0','_','_','_','_','_','_','_'],
    ['_','_','_','_','0','1','1','M','m','2','2','2','2','m','M','1','1','0','_','_','_','_','_','_'],
    ['_','_','_','0','1','1','M','m','2','2','2','2','2','2','m','M','1','1','0','_','_','_','_','_'],
    ['_','_','0','1','1','M','m','2','2','2','2','2','2','2','2','m','M','1','1','0','_','_','_','_'],
    ['_','_','0','1','M','m','2','2','2','2','2','2','2','2','2','2','m','M','1','0','_','_','_','_'],
    ['_','_','0','1','m','2','2','2','2','2','2','2','2','2','2','2','2','m','1','0','_','_','_','_'],
    ['_','_','0','1','1','2','2','2','2','2','2','2','2','2','2','2','2','2','1','0','_','_','_','_'],
    ['_','_','0','1','1','2','2','2','2','2','2','2','2','2','2','2','2','2','1','0','_','_','_','_'],
    ['_','_','0','1','1','2','2','2','2','2','2','2','2','2','2','2','2','2','1','0','_','_','_','_'],
    ['_','_','0','1','1','2','2','2','2','2','2','2','2','2','2','2','2','2','1','0','_','_','_','_'],
    ['_','_','0','1','1','2','2','2','2','2','2','2','2','2','2','2','2','2','3','0','_','_','_','_'],
    ['_','_','0','m','M','2','2','2','2','2','2','2','2','2','2','2','2','M','m','0','_','_','_','_'],
    ['_','_','0','M','m','2','2','2','2','2','2','2','2','2','2','2','m','M','3','0','_','_','_','_'],
    ['_','_','0','m','M','m','2','2','2','2','2','2','2','2','2','m','M','m','3','0','_','_','_','_'],
    ['_','_','0','M','m','M','m','2','2','2','2','2','2','2','m','M','m','M','3','0','_','_','_','_'],
    ['_','_','0','m','M','m','M','m','2','2','2','2','2','m','M','m','M','m','3','0','_','_','_','_'],
    ['_','_','0','3','m','M','m','M','m','m','m','m','m','M','m','M','m','3','3','0','_','_','_','_'],
    ['_','0','4','4','4','m','M','m','M','m','m','m','M','m','M','m','4','4','4','4','0','_','_','_'],
    ['_','0','B','B','B','B','m','M','m','M','M','M','m','M','m','B','B','B','B','B','0','_','_','_'],
    ['0','4','b','b','b','b','b','m','m','m','m','m','m','m','b','b','b','b','b','b','4','0','_','_'],
    ['0','4','b','b','b','b','b','b','b','b','b','b','b','b','b','b','b','b','b','b','4','0','_','_'],
    ['5','5','5','5','5','5','5','5','5','5','5','5','5','5','5','5','5','5','5','5','5','5','_','_'],
  ],
  // Style 8: Celtic cross (cross with circle)
  8: [
    ['_','_','_','_','_','_','_','_','_','_','0','0','0','0','_','_','_','_','_','_','_','_','_','_'],
    ['_','_','_','_','_','_','_','_','_','0','1','1','1','1','0','_','_','_','_','_','_','_','_','_'],
    ['_','_','_','_','_','_','_','_','_','0','1','2','2','1','0','_','_','_','_','_','_','_','_','_'],
    ['_','_','_','_','_','_','0','0','0','0','1','2','2','3','0','0','0','0','_','_','_','_','_','_'],
    ['_','_','_','_','_','0','1','1','1','0','1','2','2','3','0','1','1','1','0','_','_','_','_','_'],
    ['_','_','_','_','0','1','2','2','1','0','1','2','2','3','0','1','2','2','1','0','_','_','_','_'],
    ['_','_','_','0','1','2','2','2','2','1','1','2','2','3','1','2','2','2','2','1','0','_','_','_'],
    ['_','_','0','1','1','2','2','2','2','2','2','2','2','2','2','2','2','2','2','1','1','0','_','_'],
    ['_','_','0','1','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','1','0','_','_'],
    ['_','_','0','3','1','2','2','2','2','2','2','2','2','2','2','2','2','2','2','1','3','0','_','_'],
    ['_','_','_','0','1','2','2','2','2','3','3','2','2','3','3','2','2','2','2','1','0','_','_','_'],
    ['_','_','_','_','0','1','2','2','3','0','0','2','2','0','0','3','2','2','1','0','_','_','_','_'],
    ['_','_','_','_','_','0','1','1','0','_','0','1','2','0','_','0','1','1','0','_','_','_','_','_'],
    ['_','_','_','_','_','_','0','0','_','_','0','1','2','0','_','_','0','0','_','_','_','_','_','_'],
    ['_','_','_','_','_','_','_','_','_','_','0','1','2','3','0','_','_','_','_','_','_','_','_','_'],
    ['_','_','_','_','_','_','_','_','_','_','0','1','2','3','0','_','_','_','_','_','_','_','_','_'],
    ['_','_','_','_','_','_','_','_','_','_','0','1','2','3','0','_','_','_','_','_','_','_','_','_'],
    ['_','_','_','_','_','_','_','_','_','_','0','1','3','3','0','_','_','_','_','_','_','_','_','_'],
    ['_','_','_','_','_','_','_','_','_','_','0','3','3','3','0','_','_','_','_','_','_','_','_','_'],
    ['_','_','_','_','_','_','0','0','0','0','4','4','4','4','0','0','0','0','_','_','_','_','_','_'],
    ['_','_','_','_','_','0','B','B','B','B','B','B','B','B','B','B','B','B','0','_','_','_','_','_'],
    ['_','_','_','_','0','4','b','b','b','b','b','b','b','b','b','b','b','b','4','0','_','_','_','_'],
    ['_','_','_','_','0','4','b','b','b','b','b','b','b','b','b','b','b','b','4','0','_','_','_','_'],
    ['_','_','_','_','5','5','5','5','5','5','5','5','5','5','5','5','5','5','5','5','_','_','_','_'],
  ],
};

export default function Tombstone({ 
  style, 
  name, 
  birthDate, 
  deathDate, 
  epitaph, 
  onClick,
  className = ''
}: TombstoneProps) {
  const [isHovered, setIsHovered] = useState(false);
  const isCrossStyle = style === 2 || style === 8;

  const getYear = (dateString: string | null | undefined): string => {
    if (!dateString) return '?';
    const year = dateString.split('-')[0];
    return year || '?';
  };

  const renderPixelArt = () => {
    const design = TOMBSTONE_DESIGNS[style] || TOMBSTONE_DESIGNS[1];
    const pixelSize = 100 / 24;
    
    return (
      <div className="absolute inset-0" style={{ imageRendering: 'pixelated' }}>
        {design.map((row, y) => 
          row.map((pixel, x) => {
            if (pixel === '_') return null;
            return (
              <div
                key={`${x}-${y}`}
                className="absolute"
                style={{
                  left: `${x * pixelSize}%`,
                  top: `${y * pixelSize}%`,
                  width: `${pixelSize + 0.5}%`,
                  height: `${pixelSize + 0.5}%`,
                  backgroundColor: COLORS[pixel] || 'transparent',
                }}
              />
            );
          })
        )}
      </div>
    );
  };

  const renderText = () => {
    const birthYear = getYear(birthDate);
    const deathYear = getYear(deathDate);
    
    // For cross styles, show text on hover only as tooltip
    if (isCrossStyle) {
      return (
        <div 
          className={`absolute bottom-full left-1/2 -translate-x-1/2 mb-2 transition-opacity duration-300 z-30 pointer-events-none
            ${isHovered ? 'opacity-100' : 'opacity-0'}`}
        >
          <div 
            className="relative overflow-hidden min-w-[200px] max-w-[280px]"
            style={{
              clipPath: 'polygon(3px 0, calc(100% - 3px) 0, 100% 3px, 100% calc(100% - 3px), calc(100% - 3px) 100%, 3px 100%, 0 calc(100% - 3px), 0 3px)'
            }}
          >
            <div className="absolute inset-0">
              <div className="absolute inset-0 bg-gradient-to-br from-gray-800 to-gray-900"></div>
              <div className="absolute inset-0 bg-black bg-opacity-40"></div>
            </div>
            <div className="relative px-4 py-3 space-y-1">
              <p className="text-sm md:text-base font-bold pixel-text text-gray-100 leading-tight">
                {name}
              </p>
              {(birthDate || deathDate) && (
                <p className="text-xs md:text-sm pixel-text text-gray-300 leading-tight">
                  {birthYear} - {deathYear}
                </p>
              )}
              <p className="text-xs md:text-sm pixel-text text-gray-400 leading-relaxed pt-1">
                "{epitaph}"
              </p>
            </div>
          </div>
        </div>
      );
    }
    
    // For regular tombstones, show text always
    return (
      <div className="absolute top-[25%] left-[8%] right-[8%] bottom-[28%] flex items-center justify-center z-10 overflow-hidden">
        <div className="text-center w-full px-1">
          <p className="text-[7px] md:text-[9px] font-bold pixel-text text-gray-200 leading-tight truncate w-full"
             style={{ textShadow: '1px 1px 0 #000' }}>
            {name}
          </p>
          {(birthDate || deathDate) && (
            <p className="text-[6px] md:text-[7px] pixel-text text-gray-300 leading-tight truncate"
               style={{ textShadow: '1px 1px 0 #000' }}>
              {birthYear} - {deathYear}
            </p>
          )}
          <p className="text-[5px] md:text-[6px] pixel-text text-gray-400 leading-tight line-clamp-2 mt-0.5"
             style={{ textShadow: '1px 1px 0 #000' }}>
            {epitaph}
          </p>
        </div>
      </div>
    );
  };

  return (
    <div 
      className={`w-24 h-32 md:w-32 md:h-40 relative cursor-pointer transition-transform duration-300 hover:scale-105 ${className}`}
      onClick={onClick}
      onMouseEnter={() => setIsHovered(true)}
      onMouseLeave={() => setIsHovered(false)}
      style={{ imageRendering: 'pixelated' }}
    >
      {renderPixelArt()}
      {renderText()}
    </div>
  );
}
